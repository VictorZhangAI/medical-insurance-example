<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>定点医疗机构信息管理</title>
<link rel="icon" href="./pictures/logo.ico" type="image/ico">
<meta name="keywords" content="LightYear,光年,后台模板,后台管理系统,光年HTML模板">
<meta name="description" content="LightYear是一个基于Bootstrap v3.3.7的后台管理系统的HTML模板。">
<meta name="author" content="yinqi">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/materialdesignicons.min.css" rel="stylesheet">
<link href="css/style.min.css" rel="stylesheet">
</head>
  
<body>
<div class="lyear-layout-web">
  <div class="lyear-layout-container">
    <!--左侧导航-->
    <aside class="lyear-layout-sidebar">
      <!-- logo -->
      <div id="logo" class="sidebar-header">
        <a href="login.html"><img src="./pictures/logo.ico" title="LightYear" alt="LightYear" /><span style="margin-left: 1em;">医疗保险管理系统</span></a>
      </div>
      <div class="lyear-layout-sidebar-scroll"> 
        <nav class="sidebar-main">
          <ul class="nav nav-drawer">
            <li class="nav-item"> <a href="main.html"><i class="mdi mdi-home"></i> 后台首页</a> </li>
            <li class="nav-item nav-item-has-subnav active">
              <a href="javascript:void(0)"><i class="mdi mdi-palette"></i>医疗基本信息维护</a>
              <ul class="nav nav-subnav">
                <li> <a href="medicine.html">药品信息管理</a> </li>
                <li> <a href="medicine_add.html">添加药品信息</a> </li>
                <li> <a href="diagnosis.html">诊疗项目信息管理</a> </li>
                <li> <a href="diagnosis_add.html">添加诊疗项目信息</a> </li>
                <li> <a href="service_facilities.html">服务设施项目信息管理</a> </li>
                <li> <a href="service_facilities_add.html">添加服务设施项目信息</a> </li>
                <li class="active"> <a href="medical_institution.html">定点医疗机构信息管理</a> </li>
                <li> <a href="medical_institution_add.html">添加定点医疗机构信息</a> </li>
                <li> <a href="disease_info.html">病种信息维护</a> </li>
                <li> <a href="treatment_param.html">医疗待遇计算参数维护</a> </li>
              </ul>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-format-align-justify"></i> 医保待遇审批</a>
              <ul class="nav nav-subnav"></ul>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-file-outline"></i> 公共业务</a>
              <ul class="nav nav-subnav"></ul>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-language-javascript"></i> 医保中心报销</a>
              <ul class="nav nav-subnav"></ul>
            </li>
            <li class="nav-item nav-item-has-subnav">
              <a href="javascript:void(0)"><i class="mdi mdi-menu"></i> 信息查询</a>
              <ul class="nav nav-subnav"></ul>
            </li>
          </ul>
        </nav>
        <div class="sidebar-footer">
          <p class="copyright">Copyright © 2025 <a>HITWH-QD group 12</a>. All rights reserved.</p>
        </div>
      </div>
    </aside>
    <!--End 左侧导航-->
    
    <!--头部信息-->
    <header class="lyear-layout-header">
      <nav class="navbar navbar-default">
        <div class="topbar">
          <div class="topbar-left">
            <div class="lyear-aside-toggler">
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
            </div>
            <span class="navbar-page-title"> 定点医疗机构信息管理 </span>
          </div>
          <ul class="topbar-right">
            <li class="dropdown dropdown-profile">
              <a href="javascript:void(0)" data-toggle="dropdown">
                <span>用户名 <span class="caret"></span></span>
              </a>
              <ul class="dropdown-menu dropdown-menu-right">
                <li> <a href="lyear_pages_profile.html"><i class="mdi mdi-account"></i> 个人信息</a> </li>
                <li> <a href="lyear_pages_edit_pwd.html"><i class="mdi mdi-lock-outline"></i> 修改密码</a> </li>
                <li> <a href="javascript:void(0)"><i class="mdi mdi-delete"></i> 清空缓存</a></li>
                <li class="divider"></li>
                <li> <a href="lyear_pages_login.html"><i class="mdi mdi-logout-variant"></i> 退出登录</a> </li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <!--End 头部信息-->
    
    <!--页面主要内容-->
    <main class="lyear-layout-content">
        <div class="card">
              <div class="card-header"><h4>定点医疗机构信息输入</h4></div>
              <div class="card-body">
                <form action="#" method="post" onsubmit="return false;">
                  <div class="form-group row">
                    <label for="diaName" class="col-xs-2 control-label">项目名称</label>
                    <div class="col-xs-4">
                      <input class="form-control" type="text" id="diaName" name="diaName" placeholder="请输入项目名称..">
                    </div>
                    <label for="diaID" class="col-xs-2 control-label">诊疗项目编码</label>
                    <div class="col-xs-4">
                      <input class="form-control" type="text" id="diaID" name="diaID" placeholder="请输入诊疗项目编码..">
                    </div>
                  </div>
                  <div class="form-group" style="margin-left: 25em; margin-right: 25em;">
                    <button class="btn btn-primary" type="submit">模糊查询</button>
                    <button class="btn btn-default" type="submit">清空查询</button>
                  </div>
                </form>
              </div>
            </div>
        <div class="row">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-header">
                <h4>定点医疗机构信息（点击项目名称查看更多信息）</h4>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>诊疗项目编码</th>
                        <th>项目名称</th>
                        <th>收费类别</th>
                        <th>收费项目等级</th>
                        <th>最高限价</th>
                        <th>开始日期</th>
                        <th>终止日期</th>
                        <th>有效标志</th>
                        <th>医院等级</th>
                        <th>是否需要审批</th>
                        <th>操作</th>
                      </tr>
                    </thead>
                    <tbody id="medical-institution-table-body">
                      <!-- 数据由 JS 动态渲染 -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <!--End 页面主要内容-->
  </div>
</div>
<!-- 编辑医疗机构Modal -->
<div class="modal fade" id="medicalInstitutionEditModal" tabindex="-1" role="dialog" aria-labelledby="medicalInstitutionEditModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="medicalInstitutionEditModalLabel">编辑定点医疗机构信息</h4>
      </div>
      <div class="modal-body">
        <form id="medical-institution-edit-form">
          <input type="hidden" id="edit-diaID" name="diaID">
          <div class="form-group">
            <label for="edit-diaName">项目名称</label>
            <input type="text" class="form-control" id="edit-diaName" name="diaName">
          </div>
          <div class="form-group">
            <label for="edit-diaExpType">收费类别</label>
            <input type="text" class="form-control" id="edit-diaExpType" name="diaExpType">
          </div>
          <div class="form-group">
            <label for="edit-diaExpLevel">收费项目等级</label>
            <input type="text" class="form-control" id="edit-diaExpLevel" name="diaExpLevel">
          </div>
          <div class="form-group">
            <label for="edit-diaMaxPrize">最高限价</label>
            <input type="number" class="form-control" id="edit-diaMaxPrize" name="diaMaxPrize">
          </div>
          <div class="form-group">
            <label for="edit-diaStarttime">开始日期</label>
            <input type="date" class="form-control" id="edit-diaStarttime" name="diaStarttime">
          </div>
          <div class="form-group">
            <label for="edit-diaEndtime">终止日期</label>
            <input type="date" class="form-control" id="edit-diaEndtime" name="diaEndtime">
          </div>
          <div class="form-group">
            <label for="edit-diaValid">有效标志</label>
            <select class="form-control" id="edit-diaValid" name="diaValid">
              <option value="1">有效</option>
              <option value="0">无效</option>
            </select>
          </div>
          <div class="form-group">
            <label for="edit-diaHosLevel">医院等级</label>
            <input type="text" class="form-control" id="edit-diaHosLevel" name="diaHosLevel">
          </div>
          <div class="form-group">
            <label for="edit-diaApprovalmark">是否需要审批</label>
            <select class="form-control" id="edit-diaApprovalmark" name="diaApprovalmark">
              <option value="1">是</option>
              <option value="0">否</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" id="save-medical-institution-edit">保存</button>
      </div>
    </div>
  </div>
</div>
<!-- 删除确认Modal -->
<div class="modal fade" id="medicalInstitutionDeleteModal" tabindex="-1" role="dialog" aria-labelledby="medicalInstitutionDeleteModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="medicalInstitutionDeleteModalLabel">确认删除</h4>
      </div>
      <div class="modal-body">
        <p>确定要删除该定点医疗机构信息吗？</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-danger" id="confirm-medical-institution-delete">删除</button>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/perfect-scrollbar.min.js"></script>
<script type="text/javascript" src="js/main.min.js"></script>
<script type="text/javascript">
$(function() {
    function fetchMedicalInstitutions(diaName, diaID) {
        var params = {};
        if (diaName) params.diaName = diaName;
        if (diaID) params.diaID = diaID;
        $.get('/api/medical-institutions', params, function(data) {
            var tbody = '';
            data.forEach(function(item) {
                tbody += '<tr>' +
                    '<td>' + (item.diaId || '') + '</td>' +
                    '<td>' + (item.diaName || '') + '</td>' +
                    '<td>' + (item.diaExpType || '') + '</td>' +
                    '<td>' + (item.diaExpLevel || '') + '</td>' +
                    '<td>' + (item.diaMaxPrize == null ? '' : item.diaMaxPrize) + '</td>' +
                    '<td>' + (item.diaStarttime ? item.diaStarttime.substring(0, 10) : '') + '</td>' +
                    '<td>' + (item.diaEndtime ? item.diaEndtime.substring(0, 10) : '') + '</td>' +
                    '<td>' + (item.diaValid ? '有效' : '无效') + '</td>' +
                    '<td>' + (item.diaHosLevel || '') + '</td>' +
                    '<td>' + (item.diaApprovalmark ? '是' : '否') + '</td>' +
                    '<td>' +
                    '<button class="btn btn-xs btn-warning medical-institution-edit-btn" data-id="' + (item.diaId || '') + '">编辑</button> ' +
                    '<button class="btn btn-xs btn-danger medical-institution-delete-btn" data-id="' + (item.diaId || '') + '">删除</button>' +
                    '</td>' +
                '</tr>';
            });
            $('#medical-institution-table-body').html(tbody);
        });
    }
    fetchMedicalInstitutions();
    // 查询按钮
    $('.btn-primary[type="submit"]').off('click').on('click', function(e) {
        e.preventDefault();
        var name = $('#diaName').val();
        var id = $('#diaID').val();
        fetchMedicalInstitutions(name, id);
    });
    // 清空按钮
    $('.btn-default[type="submit"]').off('click').on('click', function(e) {
        e.preventDefault();
        $('#diaName').val('');
        $('#diaID').val('');
        fetchMedicalInstitutions();
    });
    // 编辑按钮事件
    $(document).on('click', '.medical-institution-edit-btn', function() {
        var diaId = $(this).data('id');
        $.get('/api/medical-institutions/' + diaId, function(item) {
            $('#edit-diaID').val(item.diaId);
            $('#edit-diaName').val(item.diaName);
            $('#edit-diaExpType').val(item.diaExpType);
            $('#edit-diaExpLevel').val(item.diaExpLevel);
            $('#edit-diaMaxPrize').val(item.diaMaxPrize);
            $('#edit-diaStarttime').val(item.diaStarttime ? item.diaStarttime.substring(0, 10) : '');
            $('#edit-diaEndtime').val(item.diaEndtime ? item.diaEndtime.substring(0, 10) : '');
            $('#edit-diaValid').val(item.diaValid ? '1' : '0');
            $('#edit-diaHosLevel').val(item.diaHosLevel);
            $('#edit-diaApprovalmark').val(item.diaApprovalmark ? '1' : '0');
            $('#medicalInstitutionEditModal').modal('show');
        });
    });
    // 保存编辑
    $('#save-medical-institution-edit').off('click').on('click', function() {
        var data = {
            diaID: $('#edit-diaID').val(),
            diaName: $('#edit-diaName').val(),
            diaExpType: $('#edit-diaExpType').val(),
            diaExpLevel: $('#edit-diaExpLevel').val(),
            diaMaxPrize: $('#edit-diaMaxPrize').val(),
            diaStarttime: $('#edit-diaStarttime').val(),
            diaEndtime: $('#edit-diaEndtime').val(),
            diaValid: $('#edit-diaValid').val(),
            diaHosLevel: $('#edit-diaHosLevel').val(),
            diaApprovalmark: $('#edit-diaApprovalmark').val()
        };
        $.ajax({
            url: '/api/medical-institutions/' + data.diaID,
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(res) {
                $('#medicalInstitutionEditModal').modal('hide');
                alert('修改成功！');
                fetchMedicalInstitutions();
            },
            error: function() {
                alert('修改失败，请检查输入或稍后重试！');
            }
        });
    });
    // 删除按钮事件
    var deleteDiaId = null;
    $(document).on('click', '.medical-institution-delete-btn', function() {
        deleteDiaId = $(this).data('id');
        $('#medicalInstitutionDeleteModal').modal('show');
    });
    // 确认删除
    $('#confirm-medical-institution-delete').off('click').on('click', function() {
        if (!deleteDiaId) return;
        $.ajax({
            url: '/api/medical-institutions/' + deleteDiaId,
            type: 'DELETE',
            success: function() {
                $('#medicalInstitutionDeleteModal').modal('hide');
                alert('删除成功！');
                fetchMedicalInstitutions();
            },
            error: function() {
                alert('删除失败，请稍后重试！');
            }
        });
    });
});
</script>
</body>
</html> 